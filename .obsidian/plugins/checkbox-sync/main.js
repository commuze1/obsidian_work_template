/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var et=Object.create;var N=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var it=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty;var ot=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),st=(r,e)=>{for(var t in e)N(r,t,{get:e[t],enumerable:!0})},xe=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of nt(e))!rt.call(r,i)&&i!==t&&N(r,i,{get:()=>e[i],enumerable:!(n=tt(e,i))||n.enumerable});return r};var at=(r,e,t)=>(t=r!=null?et(it(r)):{},xe(e||!r||!r.__esModule?N(t,"default",{value:r,enumerable:!0}):t,r)),lt=r=>xe(N({},"__esModule",{value:!0}),r);var Ke=ot((Si,Ce)=>{function De(r){return Array.isArray(r)?r:[r]}var dt=void 0,pe="",Be=" ",de="\\",pt=/^\s+$/,mt=/(?:[^\\]|^)\\$/,ft=/^\\!/,yt=/^\\#/,St=/\r?\n/g,Ct=/^\.{0,2}\/|^\.{1,2}$/,xt=/\/$/,k="/",Ue="node-ignore";typeof Symbol!="undefined"&&(Ue=Symbol.for("node-ignore"));var $e=Ue,I=(r,e,t)=>(Object.defineProperty(r,e,{value:t}),t),bt=/([0-z])-([0-z])/g,He=()=>!1,vt=r=>r.replace(bt,(e,t,n)=>t.charCodeAt(0)<=n.charCodeAt(0)?e:pe),wt=r=>{let{length:e}=r;return r.slice(0,e-e%2)},Et=[[/^\uFEFF/,()=>pe],[/((?:\\\\)*?)(\\?\s+)$/,(r,e,t)=>e+(t.indexOf("\\")===0?Be:pe)],[/(\\+?)\s/g,(r,e)=>{let{length:t}=e;return e.slice(0,t-t%2)+Be}],[/[\\$.|*+(){^]/g,r=>`\\${r}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(r,e,t)=>e+6<t.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(r,e,t)=>{let n=t.replace(/\\\*/g,"[^\\/]*");return e+n}],[/\\\\\\(?=[$.|*+(){^])/g,()=>de],[/\\\\/g,()=>de],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(r,e,t,n,i)=>e===de?`\\[${t}${wt(n)}${i}`:i==="]"&&n.length%2===0?`[${vt(t)}${n}]`:"[]"],[/(?:[^*])$/,r=>/\/$/.test(r)?`${r}$`:`${r}(?=$|\\/$)`]],kt=/(^|\\\/)?\\\*$/,L="regex",Q="checkRegex",Re="_",Tt={[L](r,e){return`${e?`${e}[^/]+`:"[^/]*"}(?=$|\\/$)`},[Q](r,e){return`${e?`${e}[^/]*`:"[^/]*"}(?=$|\\/$)`}},_t=r=>Et.reduce((e,[t,n])=>e.replace(t,n.bind(r)),r),Z=r=>typeof r=="string",Pt=r=>r&&Z(r)&&!pt.test(r)&&!mt.test(r)&&r.indexOf("#")!==0,It=r=>r.split(St).filter(Boolean),me=class{constructor(e,t,n,i,o,s){this.pattern=e,this.mark=t,this.negative=o,I(this,"body",n),I(this,"ignoreCase",i),I(this,"regexPrefix",s)}get regex(){let e=Re+L;return this[e]?this[e]:this._make(L,e)}get checkRegex(){let e=Re+Q;return this[e]?this[e]:this._make(Q,e)}_make(e,t){let n=this.regexPrefix.replace(kt,Tt[e]),i=this.ignoreCase?new RegExp(n,"i"):new RegExp(n);return I(this,t,i)}},Lt=({pattern:r,mark:e},t)=>{let n=!1,i=r;i.indexOf("!")===0&&(n=!0,i=i.substr(1)),i=i.replace(ft,"!").replace(yt,"#");let o=_t(i);return new me(r,e,i,t,n,o)},fe=class{constructor(e){this._ignoreCase=e,this._rules=[]}_add(e){if(e&&e[$e]){this._rules=this._rules.concat(e._rules._rules),this._added=!0;return}if(Z(e)&&(e={pattern:e}),Pt(e.pattern)){let t=Lt(e,this._ignoreCase);this._added=!0,this._rules.push(t)}}add(e){return this._added=!1,De(Z(e)?It(e):e).forEach(this._add,this),this._added}test(e,t,n){let i=!1,o=!1,s;this._rules.forEach(c=>{let{negative:l}=c;o===l&&i!==o||l&&!i&&!o&&!t||!c[n].test(e)||(i=!l,o=l,s=l?dt:c)});let a={ignored:i,unignored:o};return s&&(a.rule=s),a}},Ft=(r,e)=>{throw new e(r)},f=(r,e,t)=>Z(r)?r?f.isNotRelative(r)?t(`path should be a \`path.relative()\`d string, but got "${e}"`,RangeError):!0:t("path must not be empty",TypeError):t(`path must be a string, but got \`${e}\``,TypeError),Me=r=>Ct.test(r);f.isNotRelative=Me;f.convert=r=>r;var ye=class{constructor({ignorecase:e=!0,ignoreCase:t=e,allowRelativePaths:n=!1}={}){I(this,$e,!0),this._rules=new fe(t),this._strictPathCheck=!n,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(e){return this._rules.add(e)&&this._initCache(),this}addPattern(e){return this.add(e)}_test(e,t,n,i){let o=e&&f.convert(e);return f(o,e,this._strictPathCheck?Ft:He),this._t(o,t,n,i)}checkIgnore(e){if(!xt.test(e))return this.test(e);let t=e.split(k).filter(Boolean);if(t.pop(),t.length){let n=this._t(t.join(k)+k,this._testCache,!0,t);if(n.ignored)return n}return this._rules.test(e,!1,Q)}_t(e,t,n,i){if(e in t)return t[e];if(i||(i=e.split(k).filter(Boolean)),i.pop(),!i.length)return t[e]=this._rules.test(e,n,L);let o=this._t(i.join(k)+k,t,n,i);return t[e]=o.ignored?o:this._rules.test(e,n,L)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return De(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}},Se=r=>new ye(r),Nt=r=>f(r&&f.convert(r),r,He);if(typeof process!="undefined"&&(process.env&&process.env.IGNORE_TEST_WIN32||process.platform==="win32")){let r=t=>/^\\\\\?\\/.test(t)||/["<>|\u0000-\u001F]+/u.test(t)?t:t.replace(/\\/g,"/");f.convert=r;let e=/^[a-z]:\//i;f.isNotRelative=t=>e.test(t)||Me(t)}Ce.exports=Se;Se.default=Se;Ce.exports.isPathValid=Nt});var Vt={};st(Vt,{default:()=>ce});module.exports=lt(Vt);var Ye=require("obsidian");var he=require("obsidian"),A=class{constructor(e,t,n,i){this.plugin=e,this.app=t,this.syncController=n,this.fileStateHolder=i}registerEvents(){this.plugin.registerEvent(this.app.vault.on("modify",async e=>{e instanceof he.TFile&&e.extension==="md"&&(window.CHECKBOX_SYNC_DEBUG&&console.log(`modify file ${e.path}`),await this.syncController.syncFile(e))})),this.plugin.registerEvent(this.app.workspace.on("editor-change",async(e,t)=>{var n;window.CHECKBOX_SYNC_DEBUG&&console.log(`editor-change file ${(n=t.file)==null?void 0:n.path}`),await this.syncController.syncEditor(e,t)})),this.plugin.registerEvent(this.app.vault.on("delete",e=>{e instanceof he.TFile&&e.extension==="md"&&this.fileStateHolder.delete(e)}))}};var $t=new Error("timeout while waiting for mutex to become available"),Ht=new Error("mutex already locked"),ct=new Error("request for lock canceled"),ht=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(h){try{l(n.next(h))}catch(g){s(g)}}function c(h){try{l(n.throw(h))}catch(g){s(g)}}function l(h){h.done?o(h.value):i(h.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},ge=class{constructor(e,t=ct){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((n,i)=>{let o={resolve:n,reject:i,weight:e,priority:t},s=be(this._queue,a=>t<=a.priority);s===-1&&e<=this._value?this._dispatchItem(o):this._queue.splice(s+1,0,o)})}runExclusive(e){return ht(this,arguments,void 0,function*(t,n=1,i=0){let[o,s]=yield this.acquire(n,i);try{return yield t(o)}finally{s()}})}waitForUnlock(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(n=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),gt(this._weightedWaiters[e-1],{resolve:n,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){let t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){let t=this._weightedWaiters[e-1];t&&(t.forEach(n=>n.resolve()),this._weightedWaiters[e-1]=[])}else{let e=this._queue[0].priority;for(let t=this._value;t>0;t--){let n=this._weightedWaiters[t-1];if(!n)continue;let i=n.findIndex(o=>o.priority<=e);(i===-1?n:n.splice(0,i)).forEach(o=>o.resolve())}}}_couldLockImmediately(e,t){return(this._queue.length===0||this._queue[0].priority<t)&&e<=this._value}};function gt(r,e){let t=be(r,n=>e.priority<=n.priority);r.splice(t+1,0,e)}function be(r,e){for(let t=r.length-1;t>=0;t--)if(e(r[t]))return t;return-1}var ut=function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(h){try{l(n.next(h))}catch(g){s(g)}}function c(h){try{l(n.throw(h))}catch(g){s(g)}}function l(h){h.done?o(h.value):i(h.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},p=class{constructor(e){this._semaphore=new ge(1,e)}acquire(){return ut(this,arguments,void 0,function*(e=0){let[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};var ue=require("obsidian"),V=class{constructor(e,t,n,i){this.plugin=e,this.app=t,this.syncController=n,this.fileStateHolder=i,this.markdownPostProcessorMutex=new p}registerEvents(){this.plugin.registerEvent(this.app.workspace.on("file-open",async e=>{e&&e.extension==="md"&&(window.CHECKBOX_SYNC_DEBUG&&console.log(`file-open ${e.path}`),await this.fileStateHolder.initIfNeeded(e)&&this.plugin.settings.enableAutomaticFileSync&&await this.syncController.syncFile(e))})),this.plugin.registerMarkdownPostProcessor(async(e,t)=>{await this.markdownPostProcessorMutex.runExclusive(async()=>{let n=this.app.vault.getAbstractFileByPath(t.sourcePath);n instanceof ue.TFile&&n.extension==="md"&&await this.fileStateHolder.initIfNeeded(n)&&this.plugin.settings.enableAutomaticFileSync&&await this.syncController.syncFile(n)})}),this.plugin.registerEvent(this.app.workspace.on("quick-preview",async(e,t)=>{e&&e.extension==="md"&&await this.fileStateHolder.initIfNeeded(e,t)&&this.plugin.settings.enableAutomaticFileSync&&await this.syncController.syncFile(e)})),this.plugin.app.workspace.onLayoutReady(async()=>{await this.loadAndSyncActiveFiles()})}async loadAndSyncActiveFiles(){let e=this.app.workspace.getLeavesOfType("markdown");await Promise.all(e.map(async t=>await this.initializeStateForLeaf(t)))}async initializeStateForLeaf(e){let t=e.view;if(!t.file)return;let n=t.file;window.CHECKBOX_SYNC_DEBUG&&console.log(`Initializing state for active file and its embeds: ${n.path}`);let i=new Set([n]);await this.findEmbedsRecursive(n,i);for(let o of i)try{let s=await this.fileStateHolder.initIfNeeded(o);if(this.plugin.settings.enableAutomaticFileSync===!1)continue;(s||o===n&&t.getMode()==="source")&&(o===n&&t.getMode()==="source"?await this.syncController.syncEditor(t.editor,t):await this.syncController.syncFile(o))}catch(s){console.error(`Error processing file ${o.path} during initial load:`,s)}}async findEmbedsRecursive(e,t){let n=this.app.metadataCache.getFileCache(e);if(n!=null&&n.embeds)for(let i of n.embeds){let o=this.app.metadataCache.getFirstLinkpathDest(i.link,e.path);o&&o instanceof ue.TFile&&o.extension==="md"&&(t.has(o)||(t.add(o),await this.findEmbedsRecursive(o,t)))}}};var _=class{constructor(e){this.vault=e,this.map=new Map,this.mutex=new p}async initIfNeeded(e,t){return this.has(e)?!1:await this.mutex.runExclusive(async()=>this.has(e)?!1:(t||(t=await this.vault.read(e)),this.set(e,t),!0))}has(e){return this.map.has(e)}set(e,t){t!==this.map.get(e)&&(window.CHECKBOX_SYNC_DEBUG&&console.log(`File "${e.name}" load to holder`),this.map.set(e,t))}setByPath(e,t){let n=this.vault.getFileByPath(e);if(n)this.set(n,t);else throw new Error(`file not found by path: ${e}.`)}get(e){return this.map.get(e)}getByPath(e){let t=this.vault.getFileByPath(e);if(t)return this.get(t)}getAllFiles(){let e=this.map.keys();return Array.from(e)}delete(e){return this.map.delete(e)}};var E=require("obsidian");var m=(i=>(i.Checked="checked",i.Unchecked="unchecked",i.Ignore="ignore",i.NoCheckbox="noCheckbox",i))(m||{}),B={tabSize:4,enableAutomaticParentState:!0,enableAutomaticChildState:!0,checkedSymbols:["x"],uncheckedSymbols:[" "],ignoreSymbols:[],unknownSymbolPolicy:"checked",enableAutomaticFileSync:!1,consoleEnabled:!1,pathGlobs:[]};var R=class{constructor(e){this.errorElement=e.createDiv({cls:"checkbox-sync-settings-error"}),this.applyStyles()}applyStyles(){this.errorElement.style.color="var(--text-error)",this.errorElement.style.marginTop="10px",this.errorElement.style.marginBottom="10px",this.errorElement.style.minHeight="1.5em",this.errorElement.style.whiteSpace="pre-wrap",this.errorElement.style.userSelect="text"}displayErrors(e){if(e&&e.length>0){let t=e.map(n=>`\u274C ${n.field?`[${n.field}]: `:""}${n.message}`).join(`
`);this.errorElement.setText(t)}else this.clear()}displayMessage(e){e?this.errorElement.setText(`\u274C ${e}`):this.clear()}clear(){this.errorElement.setText("")}};var b=class{constructor(e,t,n){this.title=e,this.components=t,this.description=n}render(e,t){e.createEl("h3",{text:this.title}),this.description&&e.createEl("p",{text:this.description,cls:"setting-item-description"});for(let n of this.components)try{let i=n.getSettingKey();i in t?n.render(e,t[i]):(console.warn(`Setting key "${i}" not found in current settings for component in group "${this.title}". Rendering with default or undefined value might occur.`),n.render(e,void 0))}catch(i){console.error(`Error rendering component for key "${n.getSettingKey()}" in group "${this.title}":`,i),e.createDiv({text:`Error rendering setting: ${n.getSettingKey()}`,cls:"checkbox-sync-settings-error"})}}};var ve=require("obsidian"),D=class{constructor(e,t){this.actions=t;this.defaultApplyText="Apply Changes";this.defaultResetDefaultsText="Reset to defaults";let n=new ve.Setting(e).setClass("checkbox-sync-button-group");n.addButton(i=>{this.resetButton=i,i.setButtonText("Reset changes").setTooltip("Revert changes to the last applied settings").onClick(async()=>{await this.actions.onReset()})}),n.addButton(i=>{this.resetDefaultsButton=i,i.setButtonText(this.defaultResetDefaultsText).setTooltip("Reset all settings to default values and apply immediately").onClick(async()=>{await this.actions.onResetDefaults()})}),n.addButton(i=>{this.applyButton=i,i.setButtonText(this.defaultApplyText).setDisabled(!0).onClick(async()=>{await this.actions.onApply()})})}setApplyState(e){this.applyButton&&(this.applyButton.setDisabled(e.disabled),e.text!==void 0?this.applyButton.setButtonText(e.text):this.applyButton.setButtonText(this.defaultApplyText),e.cta===!0&&!e.disabled?this.applyButton.setCta():this.applyButton.removeCta())}setResetDefaultsState(e){this.resetDefaultsButton&&(this.resetDefaultsButton.setDisabled(e.disabled),e.text!==void 0?this.resetDefaultsButton.setButtonText(e.text):this.resetDefaultsButton.setButtonText(this.defaultResetDefaultsText))}};var ke=require("obsidian");function y(r){return typeof r!="boolean"?{message:"Value must be a boolean."}:null}function we(r){let e=Object.values(m);return e.includes(r)?null:{message:`Invalid checkbox state selected. Must be one of: ${e.join(", ")}.`}}function Ee(r){if(r==null||typeof r!="string")return{message:"Input must be a string."};let e=r.trim();if(e===""||e==="[]")return null;let t;try{t=JSON.parse(e)}catch(i){return{message:`Invalid JSON format: ${i.message}`}}if(!Array.isArray(t))return{message:'Invalid format: Input must be a valid JSON array (e.g., ["x", " "]).'};let n=new Set;for(let i=0;i<t.length;i++){let o=t[i];if(typeof o!="string")return{message:`Invalid content: Array element at index ${i} is not a string.`};if(o.length!==1)return{message:`Invalid content: Element "${o}" at index ${i} must be a single character.`};if(n.has(o))return{message:`Invalid content: Duplicate symbol "${o}" found.`};n.add(o)}return null}function U(r){return Array.isArray(r)?r.length===0?{message:"The list cannot be empty."}:null:{message:"Value must be an array."}}var u=class{constructor(){this.onChangeCallback=()=>{}}setChangeListener(e){this.onChangeCallback=e}createFragmentWithHTML(e){return createFragment(t=>{t.createDiv().innerHTML=e})}};var S=class extends u{constructor(){super()}arrayToJsonString(e){if(!e)return"[]";try{return JSON.stringify(e)}catch(t){return console.error(`[${this.getSettingKey()}] Error stringifying array to JSON:`,t),"[]"}}getValueFromUi(){if(this.textInput){let t=this.textInput.getValue().trim();if(t===""||t==="[]")return[];try{let n=JSON.parse(t);if(!Array.isArray(n))throw new Error("Input must be a valid JSON array.");return n}catch(n){throw new Error(`Invalid JSON format: ${n.message}`)}}throw new Error(`[${this.getSettingKey()}] Cannot get value from UI before component is rendered.`)}setValueInUi(e){if(this.textInput){if(!Array.isArray(e)){console.warn(`[${this.getSettingKey()}] Attempted to set non-array value in TextArray component. Value:`,e),this.textInput.setValue("[]");return}let t=this.arrayToJsonString(e);this.textInput.setValue(t)}else throw new Error(`[${this.getSettingKey()}] Cannot set value before component is rendered.`)}validate(){let e;try{if(this.textInput)e=this.textInput.getValue();else throw new Error("UI component not available for validation.");let t=Ee(e);if(t)return{field:this.getSettingKey(),message:t.message}}catch(t){return{field:this.getSettingKey(),message:t instanceof Error?t.message:String(t)}}return null}};var $=class extends S{constructor(){super()}getSettingKey(){return"checkedSymbols"}render(e,t){let n=this.arrayToJsonString(t);this.setting=new ke.Setting(e).setName("Checked Symbols").setDesc('Enter symbols as a JSON array of single-character strings. Example: ["x", "\u2713", " "]').addText(i=>{this.textInput=i,i.setPlaceholder('e.g., ["x", " "]').setValue(n).onChange(this.onChangeCallback)})}validate(){let e=super.validate();if(e)return e;let t;try{t=this.getValueFromUi()}catch(i){return{field:this.getSettingKey(),message:i instanceof Error?i.message:String(i)}}let n=U(t);return n?{field:this.getSettingKey(),message:n.message}:null}};var Te=require("obsidian");var H=class extends S{constructor(){super()}getSettingKey(){return"ignoreSymbols"}render(e,t){let n=this.arrayToJsonString(t);this.setting=new Te.Setting(e).setName("Ignore Symbols").setDesc('Checkboxes with these symbols will be ignored during automatic parent/child state updates. Example: ["-", "~"]').addText(i=>{this.textInput=i,i.setPlaceholder('e.g., ["-", "~"]').setValue(n).onChange(this.onChangeCallback)})}};var _e=require("obsidian");var M=class extends S{constructor(){super()}getSettingKey(){return"uncheckedSymbols"}render(e,t){let n=this.arrayToJsonString(t);this.setting=new _e.Setting(e).setName("Unchecked Symbols").setDesc('Enter symbols as a JSON array of single-character strings. Example: [" ", "?", ","]').addText(i=>{this.textInput=i,i.setPlaceholder('e.g., [" ", "?", ","]').setValue(n).onChange(this.onChangeCallback)})}validate(){let e=super.validate();if(e)return e;let t;try{t=this.getValueFromUi()}catch(i){return{field:this.getSettingKey(),message:i.message}}let n=U(t);return n?{field:this.getSettingKey(),message:n.message}:null}};var Pe=require("obsidian");var K=class extends u{constructor(){super()}getSettingKey(){return"unknownSymbolPolicy"}render(e,t){this.setting=new Pe.Setting(e).setName("Unknown Symbol Policy").setDesc("How to treat symbols not in Checked, Unchecked or Ignore lists.").addDropdown(n=>{this.dropdownComponent=n,n.addOption("checked","Treat as Checked").addOption("unchecked","Treat as Unchecked").addOption("ignore","Ignore").setValue(t).onChange(this.onChangeCallback)})}getValueFromUi(){if(this.dropdownComponent)return this.dropdownComponent.getValue();throw new Error(`[${this.getSettingKey()}] Cannot get value from UI before component is rendered.`)}setValueInUi(e){if(this.dropdownComponent)this.dropdownComponent.setValue(e);else throw new Error(`[${this.getSettingKey()}] Cannot set value before component is rendered.`)}validate(){let e;try{e=this.getValueFromUi()}catch(n){return{field:this.getSettingKey(),message:n instanceof Error?n.message:String(n)}}let t=we(e);return t?{field:this.getSettingKey(),message:t.message}:null}};var Ie=require("obsidian");var G=class extends u{constructor(){super()}getSettingKey(){return"enableAutomaticChildState"}render(e,t){this.setting=new Ie.Setting(e).setName("Update child checkbox state automatically").setDesc("If enabled, changing the state of a parent checkbox will automatically update the state of all its direct and nested children. If disabled, changing a parent checkbox will not affect its children.").addToggle(n=>{this.toggleComponent=n,n.setValue(t).onChange(this.onChangeCallback)})}getValueFromUi(){if(this.toggleComponent)return this.toggleComponent.getValue();throw new Error(`[${this.getSettingKey()}] Cannot get value from UI before component is rendered.`)}setValueInUi(e){if(this.toggleComponent)this.toggleComponent.setValue(e);else throw new Error(`[${this.getSettingKey()}] Cannot set value before component is rendered.`)}validate(){let e=this.getValueFromUi(),t=y(e);return t?{field:this.getSettingKey(),message:t.message}:null}};var Le=require("obsidian");var O=class extends u{constructor(){super()}getSettingKey(){return"enableAutomaticFileSync"}render(e,t){this.setting=new Le.Setting(e).setName("Enable automatic file synchronization").setDesc("If enabled (requires restart or settings reload), automatically syncs checkbox states when files are loaded/opened and after settings changes. If disabled (default), sync only occurs when you manually change a checkbox.").addToggle(n=>{this.toggleComponent=n,n.setValue(t).onChange(this.onChangeCallback)})}getValueFromUi(){if(this.toggleComponent)return this.toggleComponent.getValue();throw new Error(`[${this.getSettingKey()}] Cannot get value from UI before component is rendered.`)}setValueInUi(e){if(this.toggleComponent)this.toggleComponent.setValue(e);else throw new Error(`[${this.getSettingKey()}] Cannot set value before component is rendered.`)}validate(){let e;try{e=this.getValueFromUi()}catch(n){return{field:this.getSettingKey(),message:n instanceof Error?n.message:String(n)}}let t=y(e);return t?{field:this.getSettingKey(),message:t.message}:null}};var Fe=require("obsidian");var X=class extends u{constructor(){super()}getSettingKey(){return"enableAutomaticParentState"}render(e,t){this.setting=new Fe.Setting(e).setName("Update parent checkbox state automatically").setDesc("If enabled, the state of a parent checkbox will be automatically updated based on the state of its children (all children checked = parent checked). If disabled, only manually changing a parent will affect its children.").addToggle(n=>{this.toggleComponent=n,n.setValue(t).onChange(this.onChangeCallback)})}getValueFromUi(){if(this.toggleComponent)return this.toggleComponent.getValue();throw new Error(`[${this.getSettingKey()}] Cannot get value from UI before component is rendered.`)}setValueInUi(e){if(this.toggleComponent)this.toggleComponent.setValue(e);else throw new Error(`[${this.getSettingKey()}] Attempted to set value before component is rendered.`)}validate(){let e;try{e=this.getValueFromUi()}catch(n){return console.error(`Error getting value from UI for ${this.getSettingKey()}:`,n),{field:this.getSettingKey(),message:`Internal error getting value from UI: ${n instanceof Error?n.message:String(n)}`}}let t=y(e);return t?{field:this.getSettingKey(),message:t.message}:null}};var C=require("obsidian"),q=class extends C.Modal{constructor(e,t,n){super(e),this.message=t,this.onConfirm=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("p").setText(this.message),new C.Setting(e).addButton(t=>t.setButtonText("Cancel").onClick(()=>{this.close()})).addButton(t=>t.setButtonText("OK").setCta().onClick(()=>{this.close(),this.onConfirm()}))}onClose(){let{contentEl:e}=this;e.empty()}},w=class extends C.Modal{constructor(e,t){super(e),this.message=t}onOpen(){let{contentEl:e}=this;e.empty();let t=e.createEl("pre");t.setText(this.message),t.style.whiteSpace="pre-wrap",new C.Setting(e).addButton(n=>n.setButtonText("OK").setCta().onClick(()=>{this.close()}))}onClose(){let{contentEl:e}=this;e.empty()}},Y=class extends C.Modal{constructor(e,t,n){super(e),this.onSave=t,this.onDiscard=n}onOpen(){let{contentEl:e}=this;e.empty(),e.setText("You have unsaved changes. Save them before closing?"),new C.Setting(e).addButton(t=>t.setButtonText("Discard").onClick(()=>{this.close(),this.onDiscard()})).addButton(t=>t.setButtonText("Save").setCta().onClick(async()=>{t.setDisabled(!0).setButtonText("Saving...");try{await this.onSave(),this.close()}catch(n){console.error("Unexpected error during save callback:",n),new w(this.app,"An unexpected error occurred during save.").open(),this.close()}finally{t.setDisabled(!1).setButtonText("Save")}}))}onClose(){let{contentEl:e}=this;e.empty()}};var W=class{validate(e){var l,h,g;let t=[],n=(l=e.checkedSymbols)!=null?l:[],i=(h=e.uncheckedSymbols)!=null?h:[],o=(g=e.ignoreSymbols)!=null?g:[],s=this.findIntersection(n,i);s.length>0&&t.push({message:`Symbols found in both Checked and Unchecked lists: ${this.formatSymbolsForError(s)}`});let a=this.findIntersection(n,o);a.length>0&&t.push({message:`Symbols found in both Checked and Ignore lists: ${this.formatSymbolsForError(a)}`});let c=this.findIntersection(i,o);return c.length>0&&t.push({message:`Symbols found in both Unchecked and Ignore lists: ${this.formatSymbolsForError(c)}`}),t}findIntersection(e,t){if(!e||!t)return[];let n=new Set(t);return e.filter(i=>n.has(i))}formatSymbolsForError(e){try{return JSON.stringify(e)}catch(t){return e.join(", ")}}};var Ne=require("obsidian");var j=class extends u{constructor(){super()}getSettingKey(){return"consoleEnabled"}render(e,t){this.setting=new Ne.Setting(e).setName("Enable console logs").addToggle(n=>{this.toggleComponent=n,n.setValue(t).onChange(this.onChangeCallback)})}getValueFromUi(){if(this.toggleComponent)return this.toggleComponent.getValue();throw new Error(`[${this.getSettingKey()}] Cannot get value from UI before component is rendered.`)}setValueInUi(e){if(this.toggleComponent)this.toggleComponent.setValue(e);else throw new Error(`[${this.getSettingKey()}] Cannot set value before component is rendered.`)}validate(){let e=this.getValueFromUi(),t=y(e);return t?{field:this.getSettingKey(),message:t.message}:null}};var Ae=require("obsidian");var J=class extends u{getSettingKey(){return"pathGlobs"}arrayToMultilineString(e){if(Array.isArray(e))try{return e.join(`
`)}catch(t){return console.error(`[${this.getSettingKey()}] Error joining array to multiline string: `,t),""}return""}render(e,t){let n=this.arrayToMultilineString(t),i=`<p>Define rules to specify which files and folders the plugin should IGNORE. 
      Uses the same pattern syntax as <code>.gitignore</code> files (powered by the 'ignore' library).</p>
      <p>For detailed syntax, refer to the 
          <a href="https://git-scm.com/docs/gitignore" target="_blank" rel="noopener noreferrer">official .gitignore documentation</a>.
      </p>`;this.setting=new Ae.Setting(e).setName("File Ignore Rules (.gitignore style)").setDesc(this.createFragmentWithHTML(i)).addTextArea(o=>{this.textInput=o,o.setPlaceholder(`# Examples:
# Ignore all files in the "Drafts" folder
Drafts/

`),o.setValue(n),o.onChange(()=>{this.onChangeCallback()})}),this.makeMultilineTextSetting()}makeMultilineTextSetting(){if(!this.setting)return;let{settingEl:e,infoEl:t,controlEl:n}=this.setting,i=n.querySelector("textarea");i!==null&&(e.style.display="block",t&&(t.style.marginBottom="var(--size-4-2)",t.style.marginRight="0px"),n.style.width="100%",i.style.width="100%",i.style.minHeight="120px",i.rows=8)}getValueFromUi(){if(this.textInput)return this.textInput.getValue().split(`
`).map(t=>t.trim()).filter(t=>t.length>0&&!t.startsWith("#"));throw new Error(`[${this.getSettingKey()}] Cannot get value from UI: TextArea component not rendered or available.`)}setValueInUi(e){if(this.textInput){if(e===void 0){this.textInput.setValue("");return}this.textInput.setValue(e.join(`
`))}else throw new Error(`[${this.getSettingKey()}] Cannot set value in UI: TextArea component not rendered or available.`)}validate(){try{this.getValueFromUi()}catch(e){return{field:this.getSettingKey(),message:e.message}}return null}};var z=class extends E.PluginSettingTab{constructor(t,n){super(t,n);this.settingGroups=[];this.isDirty=!1;this.actionMutex=new p;this.plugin=n,this.initializeSettingGroups()}initializeSettingGroups(){let t=new $,n=new M,i=new K,o=new H,s=new b("Checkbox Symbol Configuration (Advanced: JSON)",[t,n,o,i],"Warning: Requires valid JSON format. Use double quotes for strings."),a=new X,c=new G,l=new O,h=new b("Synchronization Behavior",[a,c,l]),g=new J,We=new b("File Scope & Filtering",[g],"Define rules to include or exclude files/folders from plugin processing."),je=new j,Je=new b("Dev",[je]);this.settingGroups=[s,h,We,Je];let ze=()=>this.settingChanged();for(let Qe of this.settingGroups)for(let Ze of Qe.components)Ze.setChangeListener(ze)}settingChanged(){this.isDirty=!0,this.settingsControls.setApplyState({disabled:!1,cta:!0})}settingSaved(){this.isDirty=!1,this.settingsControls.setApplyState({disabled:!0,cta:!1})}display(){this.isDirty=!1;let t=this.containerEl;t.empty(),t.createEl("h2",{text:"Checkbox Sync Settings"});for(let i of this.settingGroups)i.render(t,this.plugin.settings);this.errorDisplay=new R(t);let n={onApply:()=>this.applyChanges(),onReset:()=>this.resetInputsToSavedSettings(),onResetDefaults:()=>{new q(this.app,`Reset all settings to default and apply immediately?
This cannot be undone.`,async()=>{await this.applyDefaultSettings()}).open()}};this.settingsControls=new D(t,n),this.settingsControls.setApplyState({disabled:!this.isDirty,cta:this.isDirty}),this.settingsControls.setResetDefaultsState({disabled:!1})}async applyChanges(){await this.actionMutex.runExclusive(async()=>{this.settingsControls.setApplyState({disabled:!0,text:"Applying...",cta:!1}),this.errorDisplay.clear();try{let t=await this.validateAndSaveSettings();t.success?(this.settingSaved(),new E.Notice("Checkbox Sync settings applied!",3e3)):(console.warn("Validation errors:",t.errors),this.errorDisplay.displayErrors(t.errors))}catch(t){console.error("Unexpected error during applyChanges:",t);let n=t.message||"Unknown error";this.errorDisplay.displayMessage(`An unexpected error occurred: ${n}`)}finally{this.settingsControls.setApplyState({disabled:!this.isDirty,cta:this.isDirty})}})}resetInputsToSavedSettings(){let t=this.plugin.settings;for(let n of this.settingGroups)for(let i of n.components){let o=i.getSettingKey();if(o in t)try{i.setValueInUi(t[o])}catch(s){console.error(`Error resetting UI for component ${o}:`,s)}}this.errorDisplay.clear(),this.settingSaved()}async applyDefaultSettings(){await this.actionMutex.runExclusive(async()=>{this.settingsControls.setResetDefaultsState({disabled:!0,text:"Resetting..."}),this.errorDisplay.clear();try{let t={...B};await this.plugin.updateSettings(n=>{Object.assign(n,t)}),this.resetInputsToSavedSettings(),new E.Notice("Settings reset to defaults and applied.",3e3)}catch(t){console.error("Error resetting settings to default:",t);let n=t.message||"Unknown error";this.errorDisplay.displayMessage(`Error resetting to defaults: ${n}`)}finally{this.settingsControls.setResetDefaultsState({disabled:!1})}})}async hide(){if(this.isDirty){let t=async()=>{try{let o=await this.validateAndSaveSettings();if(o.success)this.isDirty=!1,new E.Notice("Settings saved.",2e3);else{console.error("Error saving settings on hide (validation):",o.errors);let s=o.errors.map(a=>`\u274C ${a.field?`[${a.field}]: `:""}${a.message}`).join(`
`);new w(this.app,`Failed to save settings:

${s}

Your changes were not saved.`).open()}}catch(o){console.error("Error saving settings on hide (unexpected):",o);let s="An unknown error occurred.";o instanceof Error?s=o.message:typeof o=="string"&&(s=o),new w(this.app,`Failed to save settings:

${s}

Your changes were not saved.`).open()}},n=()=>{this.isDirty=!1};new Y(this.app,t,n).open()}super.hide()}async validateAndSaveSettings(){let t=[],n={};for(let i of this.settingGroups)for(let o of i.components){let s=o.getSettingKey();try{let a=o.getValueFromUi(),c=o.validate();c?t.push(c):n[s]=a}catch(a){console.error(`Error processing component ${s}:`,a),t.push({field:s,message:`Failed to read value: ${a.message}`})}}if(t.length===0){let o=new W().validate(n);t.push(...o)}if(t.length>0)return{success:!1,errors:t};try{return await this.plugin.updateSettings(i=>{Object.assign(i,n)}),{success:!0,errors:[]}}catch(i){throw console.error("Error saving settings:",i),i}}};var Ve=require("obsidian"),P=class{constructor(e,t){this.vault=e,this.textSyncPipeline=t,this.mutex=new p}async syncEditor(e,t){t.file&&await this.mutex.runExclusive(async()=>{let n=e.getValue(),i=this.textSyncPipeline.applySyncLogic(n,t.file.path);i!==n&&await this.editEditor(e,t,n,i)})}async syncFile(e){!(e instanceof Ve.TFile)||e.extension!=="md"||await this.mutex.runExclusive(async()=>{await this.vault.process(e,t=>this.textSyncPipeline.applySyncLogic(t,e.path))})}async editEditor(e,t,n,i){let o=e.getCursor(),s=i.split(`
`),a=n.split(`
`),c=this.findDifferentLineIndexes(a,s),l=[];for(let g of c)l.push({from:{line:g,ch:0},to:{line:g,ch:a[g].length},text:s[g]});e.transaction({changes:l}),e.setCursor(o);let h=c.length>0?c[0]:-1;h!=-1&&e.scrollIntoView({from:{line:h,ch:0},to:{line:h,ch:0}}),await t.save()}findDifferentLineIndexes(e,t){if(e.length!==t.length)throw new Error("the length of the lines must be equal");let n=e.length,i=[];for(let o=0;o<n;o++)e[o]!==t[o]&&i.push(o);return i}};var Ge=at(Ke()),ee=class{constructor(e){this.ignorer=null;this.settings=e,this.initIgnorer()}initIgnorer(){let e=this.settings.pathGlobs;if(e&&e.length>0){this.ignorer=(0,Ge.default)();let t=e.filter(n=>n&&n.trim()!==""&&!n.trim().startsWith("#"));t.length>0?this.ignorer.add(t):this.ignorer=null}else this.ignorer=null}isPathAllowed(e){return this.ignorer?!this.ignorer.ignores(e):!0}updateSettings(e){window.CHECKBOX_SYNC_DEBUG&&console.log("FileFilter: Settings updated."),this.settings=e,this.initIgnorer()}};var F=class{constructor(e,t,n){this.checkboxUtils=e,this.fileStateHolder=t,this.fileFilter=n}applySyncLogic(e,t){return this.fileStateHolderDecorator(e,t)}coreDecorator(e,t){return this.checkboxUtils.syncText(e,t)}pathAllowedDecorator(e,t,n){return this.fileFilter.isPathAllowed(n)?this.coreDecorator(e,t):(window.CHECKBOX_SYNC_DEBUG&&console.log(`pathAllowedDecorator "${n}" skip, path is not allowed.`),e)}fileStateHolderDecorator(e,t){let n=this.fileStateHolder.getByPath(t),i=this.pathAllowedDecorator(e,n,t);return this.fileStateHolder.setByPath(t,i),i}};var te=class{constructor(e,t,n){this.text=e,this.textBeforeChange=t,this.settings=n}getSettings(){return this.settings}textBeforeChangeIsPresent(){return!!this.textBeforeChange}getText(){return this.text}getTextLines(){return this.textLines||(this.textLines=this.getText().split(`
`)),this.textLines}getTextBeforeChange(){return this.textBeforeChange}getTextBeforeChangeLines(){var e;return this.textBeforeChangeLines||(this.textBeforeChangeLines=(e=this.textBeforeChange)==null?void 0:e.split(`
`)),this.textBeforeChangeLines}getLines(){return this.lines||(this.lines=v.createLines(this)),this.lines}getView(){return this.view||(this.view=v.createView(this)),this.view}getResultText(){return this.getView().toResultText()}};var x=class{constructor(e,t,n){this.indentString=e,this.listText=t,this.tabSize=n.tabSize,this.indent=this.getIndentFromString(e,this.tabSize)}getIndentFromString(e,t){let n=0;for(let i of e)i==="	"?n+=t:i===" "&&(n+=1);return n}getIndent(){return this.indent}getText(){return this.listText}};var T=class{};var Oe=/^(\s*)(.*)$/,Xe=/^(\s*)([*+-]|\d+\.)\s+(?!\[.?\])(.*)$/,qe=/^(\s*)([*+-]|\d+\.) \[(.)\]\s(.*)$/;var d=class r extends x{constructor(t,n,i,o,s){super(t,o,s);this.hasChange=!1;this.marker=n,this.checkChar=i,this.settings=s,this.checkboxState=this.getCheckboxState(i)}static createFromLine(t,n){let i=t.match(qe);if(i){let o=i[1],s=i[2],a=i[3],c=i[4].trimStart();return new r(o,s,a,c,n)}return null}isChange(){return this.hasChange}setChange(t){this.hasChange=t}static getNewCheckboxLineFromTasksApi(t,n,i){let o=n,s=new Set;for(s.add(n.checkChar);;){let a=o.toResultText(),c=t.executeToggleTaskDoneCommand(a,null),l=r.createFromLine(c,o.settings);if(!l)return null;if(l.checkboxState===i)return l;if(s.has(l.checkChar))return null;s.add(l.checkChar),o=l}}setState(t){var i;let n=(i=T.APP)==null?void 0:i.plugins.plugins["obsidian-tasks-plugin"];if(n){let o=n.apiV1,s=r.getNewCheckboxLineFromTasksApi(o,this,t);s!==null&&(this.listText=s.listText)}this.checkboxState=t,this.checkChar=this.getCharFromState(t)}setStateIfNotEquals(t){t!==this.checkboxState&&this.setState(t)}getState(){return this.checkboxState}toResultText(){return this.indentString+this.marker+" ["+this.checkChar+"] "+this.listText}getCheckboxState(t){return this.settings.checkedSymbols.includes(t)?"checked":this.settings.uncheckedSymbols.includes(t)?"unchecked":this.settings.ignoreSymbols.includes(t)?"ignore":this.settings.unknownSymbolPolicy}getCharFromState(t){switch(t){case"checked":return this.settings.checkedSymbols.length>0?this.settings.checkedSymbols[0]:"x";case"unchecked":return this.settings.uncheckedSymbols.length>0?this.settings.uncheckedSymbols[0]:" ";case"ignore":if(this.settings.ignoreSymbols.length>0)return this.settings.ignoreSymbols[0];throw new Error("Not found ignore char.");case"noCheckbox":throw new Error(`Unexpected value for parameter [state] = ${t}. "NoCheckbox".`);default:throw new Error(`Unexpected value for parameter [state] = ${t}.`)}}};var ne=class{constructor(e){this.childrens=[];this.modify=!1;this.line=e,e instanceof d&&e.isChange()&&(this.modify=!0)}getLine(){return this.line}isModify(){return this.modify}setModify(e){this.modify=e}setParent(e){this.parent=e}getParent(){return this.parent}addChildren(e){this.childrens.push(e),e.setParent(this)}hasChildren(){return this.childrens.length>0}getChildrenNodes(){return[...this.childrens]}toResultText(){let e=[];e.push(this.line.toResultText());for(let t of this.childrens)e.push(t.toResultText());return e.join(`
`)}};var ie=class{constructor(e,t){this.treeNodes=e,this.changeNode=t}isModify(){return!!this.changeNode}getChangeNode(){return this.changeNode}getTreeNodes(){return this.treeNodes}toResultText(){let e=[];for(let t of this.treeNodes)e.push(t.toResultText());return e.join(`
`)}};var re=class r extends x{constructor(e,t,n,i){super(e,n,i),this.marker=t}static createFromLine(e,t){let n=e.match(Xe);if(n){let i=n[1],o=n[2],s=n[3].trimStart();return new r(i,o,s,t)}return null}getMarker(){return this.marker}setMarker(e){this.marker=e}toResultText(){return this.indentString+this.marker+" "+this.listText}getState(){return"noCheckbox"}};var oe=class r extends x{static createFromLine(e,t){let n=e.match(Oe);if(n){let i=n[1],o=n[2];return new r(i,o,t)}return null}toResultText(){return this.indentString+this.listText}getState(){return"noCheckbox"}};var v=class{constructor(){}static createContext(e,t,n){return new te(e,t,n)}static createView(e){let t=e.getLines(),[n,i]=this.createRootTreeNodesFromLines(t);return new ie(n,i)}static createRootTreeNodesFromLines(e){let[t,n]=this.createFlatNodesFromLines(e);return[t.filter(o=>!o.getParent()),n]}static createFlatNodesFromLines(e){let t=[],n=[],i=null;for(let o of e){let s=new ne(o);o instanceof d&&o.isChange()&&(i=s);let a;for(;n.length>0;){let c=n[n.length-1];if(c.getLine().getIndent()<o.getIndent()){a=c;break}else n.pop()}a==null||a.addChildren(s),t.push(s),n.push(s)}return[t,i]}static createLines(e){let t=e.getSettings(),n=this.createLinesFromTextLines(e.getTextLines(),t);return this.markChangeIfNeeded(n,e),n}static markChangeIfNeeded(e,t){if(!t.textBeforeChangeIsPresent())return;let n=t.getTextLines(),i=t.getTextBeforeChangeLines();if(n.length!==i.length)return;let o=this.findSingleDiffLineIndex(n,i);if(o===void 0)return;let s=this.createLineFromTextLine(i[o],t.getSettings()),a=e[o];if(s instanceof d&&a instanceof d&&s.getState()!==a.getState()){a.setChange(!0);let c=a.toResultText();window.CHECKBOX_SYNC_DEBUG&&console.log(`ContextFactory:markChangeIfNeeded: ${c} is change`)}}static createLinesFromTextLines(e,t){return e.map(n=>this.createLineFromTextLine(n,t))}static createLineFromTextLine(e,t){let n=d.createFromLine(e,t);if(n)return n;let i=re.createFromLine(e,t);return i||oe.createFromLine(e,t)}static findSingleDiffLineIndex(e,t){let n=this.findDifferentLineIndexes(e,t);if(n.length==1)return n[0]}static findDifferentLineIndexes(e,t){if(e.length!==t.length)throw new Error("the length of the lines must be equal");let n=e.length,i=[];for(let o=0;o<n;o++)e[o]!==t[o]&&i.push(o);return i}};var se=class{process(e){if(!e.getSettings().enableAutomaticChildState)return;if(!e.textBeforeChangeIsPresent()){window.CHECKBOX_SYNC_DEBUG&&console.log("PropagateStateToChildrenProcess: textBeforeChange is not present");return}let t=e.getView();if(!t.isModify()){window.CHECKBOX_SYNC_DEBUG&&console.log("PropagateStateToChildrenProcess: not modify");return}let n=t.getChangeNode();this.propagateStateToChildrenFromNode(n)}propagateStateToChildrenFromNode(e){let t=e.getLine();if(!(t instanceof d)){console.warn("propagateStateToChildren from !CheckboxLine.");return}let n=t.getState();if(n==="ignore"||n==="noCheckbox"){console.warn(`propagateStateToChildren from uncorrect state: ${n.toString()}`);return}this.propagateStateToChildren(e,n)}propagateStateToChildren(e,t){let n=e.getLine();n instanceof d&&n.setStateIfNotEquals(t);for(let i of e.getChildrenNodes())this.propagateStateToChildren(i,t)}};var ae=class{process(e){if(!e.getSettings().enableAutomaticParentState)return;let n=e.getView().getTreeNodes();for(let i of n)this.propagateStateToParent(i)}propagateStateToParent(e){let t=e.getLine(),n=[];for(let o of e.getChildrenNodes()){let s=this.propagateStateToParent(o);n.push(s)}let i=this.getNewState(t.getState(),n);return t instanceof d&&t.setStateIfNotEquals(i),i}getNewState(e,t){if(e==="ignore")return e;let n="checked",i=!1;for(let o of t)o!=="ignore"&&o!=="noCheckbox"&&(i=!0),o==="unchecked"&&(n="unchecked");return i?n:e}};var le=class{constructor(e){this.settings=e,this.propagateStateToChildrenProcess=new se,this.propagateStateToParentProcess=new ae}syncText(e,t){if(e===t)return e;window.CHECKBOX_SYNC_DEBUG&&console.log("text before:"),window.CHECKBOX_SYNC_DEBUG&&console.log(e),window.CHECKBOX_SYNC_DEBUG&&console.log("___");let n=v.createContext(e,t,this.settings);this.propagateStateToChildrenProcess.process(n),this.propagateStateToParentProcess.process(n),window.CHECKBOX_SYNC_DEBUG&&console.log("text after:");let i=n.getResultText();return window.CHECKBOX_SYNC_DEBUG&&console.log(i),window.CHECKBOX_SYNC_DEBUG&&console.log("___"),n.getResultText()}};var At="CHECKBOX_SYNC_DEBUG",ce=class extends Ye.Plugin{async onload(){T.APP=this.app,await this.loadSettings(),this.fileFilter=new ee(this.settings),this.fileStateHolder=new _(this.app.vault),this.checkboxUtils=new le(this.settings),this.textSyncPipeline=new F(this.checkboxUtils,this.fileStateHolder,this.fileFilter),this.syncController=new P(this.app.vault,this.textSyncPipeline),this.fileLoadEventHandler=new V(this,this.app,this.syncController,this.fileStateHolder),this.fileChangeEventHandler=new A(this,this.app,this.syncController,this.fileStateHolder),this.addSettingTab(new z(this.app,this)),this.fileLoadEventHandler.registerEvents(),this.fileChangeEventHandler.registerEvents()}async loadSettings(){this._settings=Object.assign({},B,await this.loadData()),this.setDebugFlag(this.settings.consoleEnabled)}get settings(){return this._settings}async updateSettings(e){if(await e(this._settings),this.setDebugFlag(this.settings.consoleEnabled),this.fileFilter.updateSettings(this.settings),await this.saveData(this.settings),this.settings.enableAutomaticFileSync){let t=this.fileStateHolder.getAllFiles();await Promise.all(t.map(async n=>{await this.syncController.syncFile(n)}))}}setDebugFlag(e){window[At]=e}};

/* nosourcemap */